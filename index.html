<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Browser-in-Browser</title>
  <style>
    :root{
      --bg:#0f1724; --panel:#0b1220; --muted:#9aa4b2; --accent:#7c5cff; --tab:#0d1a2a; --glass: rgba(255,255,255,0.04);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071028 0%, #02111b 100%);color:#e6eef8}
    .window{box-shadow:0 10px 40px rgba(2,6,23,0.6);border-radius:10px;height:92vh;width:92vw;margin:4vh auto;display:flex;flex-direction:column;overflow:hidden;background:linear-gradient(180deg,var(--panel),#071427)}
    .toolbar{display:flex;align-items:center;padding:8px 12px;gap:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-bottom:1px solid rgba(255,255,255,0.02)}
    .controls{display:flex;gap:6px;align-items:center}
    button{background:transparent;border:0;color:var(--muted);padding:6px 8px;border-radius:8px;cursor:pointer}
    button:hover{background:var(--glass);color:var(--accent)}
    .address{flex:1;display:flex;align-items:center;gap:8px}
    .url{flex:1;background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;color:inherit;outline:none}
    .search-hint{color:var(--muted);font-size:12px}
    .tabbar{display:flex;align-items:center;gap:8px;padding:6px 12px;background:transparent;overflow:auto}
    .tab{display:flex;gap:8px;align-items:center;padding:6px 10px;border-radius:8px;background:transparent;color:var(--muted);cursor:pointer;white-space:nowrap}
    .tab.active{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:#eaf0ff}
    .tab .title{max-width:20ch;overflow:hidden;text-overflow:ellipsis}
    .new-tab{padding:6px 10px;border-radius:8px;background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));border:1px dashed rgba(255,255,255,0.02);color:var(--muted)}
    .viewport{flex:1;position:relative;background:#000}
    iframe{position:absolute;inset:0;border:0;width:100%;height:100%;background:white}
    .ntp{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:14px;color:var(--muted)}
    .ntp input{padding:12px 14px;border-radius:999px;border:1px solid rgba(255,255,255,0.04);width:min(680px,80%);background:transparent;color:inherit}
    .mini{font-size:12px;color:var(--muted)}
    .favicon{width:16px;height:16px;border-radius:3px;flex:0 0 16px;background:linear-gradient(135deg,#333,#111)}
    @media (max-width:800px){.window{width:98vw;height:94vh}}
  </style>
</head>
<body>
  <div class="window" role="application" aria-label="Browser in Browser">
    <div class="toolbar">
      <div class="controls">
        <button id="back" title="Back">‚óÄ</button>
        <button id="forward" title="Forward">‚ñ∂</button>
        <button id="reload" title="Reload">‚ü≥</button>
        <button id="home" title="Home">üè†</button>
      </div>
      <div class="address">
        <input id="url" class="url" type="text" placeholder="Enter URL or search (press Enter)" aria-label="Address bar">
        <div class="search-hint mini">Press Enter to navigate ¬∑ Ctrl+T new tab ¬∑ Ctrl+W close tab</div>
      </div>
      <div style="display:flex;gap:8px">
        <button id="newtabbtn" title="New tab">Ôºã Tab</button>
      </div>
    </div>
    <div class="tabbar" id="tabbar" aria-label="Tabs"></div>
    <div class="viewport" id="viewport"></div>
  </div>
  <script>
    const tabbar = document.getElementById('tabbar');
    const viewport = document.getElementById('viewport');
    const urlInput = document.getElementById('url');
    const newTabBtn = document.getElementById('newtabbtn');
    const backBtn = document.getElementById('back');
    const forwardBtn = document.getElementById('forward');
    const reloadBtn = document.getElementById('reload');
    const homeBtn = document.getElementById('home');
    let tabs = [];
    let activeId = null;
    function makeTab(title, startURL){
      const id = 'tab_' + Math.random().toString(36).slice(2,9);
      const history = [];
      let idx = -1;
      const tabEl = document.createElement('div');
      tabEl.className = 'tab';
      tabEl.innerHTML = `<div class="favicon" aria-hidden></div><div class="title">${title||'New Tab'}</div><div style="margin-left:8px;opacity:0.6;">‚úï</div>`;
      tabbar.appendChild(tabEl);
      const closeBtn = tabEl.querySelector('div:last-child');
      const titleEl = tabEl.querySelector('.title');
      const faviconEl = tabEl.querySelector('.favicon');
      const iframe = document.createElement('iframe');
      iframe.setAttribute('allow','geolocation; microphone; camera; clipboard-read; clipboard-write;');
      iframe.dataset.tabId = id;
      iframe.style.display = 'none';
      viewport.appendChild(iframe);
      function setActive(){
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tabEl.classList.add('active');
        document.querySelectorAll('iframe').forEach(f=>f.style.display='none');
        iframe.style.display = '';
        activeId = id;
        updateAddress();
      }
      tabEl.addEventListener('click', (e)=>{
        if(e.target === closeBtn) return;
        setActive();
      });
      closeBtn.addEventListener('click', (e)=>{e.stopPropagation(); closeTab(id);} );
      function navigate(s){
        if(!/^https?:\/\//i.test(s)){
          if(s.includes(' ') || !s.includes('.')) s = 'https://www.google.com/search?q=' + encodeURIComponent(s);
          else s = 'https://' + s.replace(/^https?:\/\//,'');
        }
        history.splice(idx+1, history.length-(idx+1));
        history.push(s);
        idx = history.length-1;
        iframe.src = s;
        titleEl.textContent = s;
        try{
          const u = new URL(s);
          faviconEl.style.backgroundImage = `url(${u.origin}/favicon.ico)`;
          faviconEl.style.backgroundSize = '16px 16px';
        }catch(e){}
        updateAddress();
      }
      function goBack(){ if(idx>0){ idx--; iframe.src = history[idx]; titleEl.textContent = history[idx]; updateAddress(); }}
      function goForward(){ if(idx < history.length-1){ idx++; iframe.src = history[idx]; titleEl.textContent = history[idx]; updateAddress(); }}
      function reload(){ if(idx>=0) iframe.src = history[idx]; else iframe.contentWindow && iframe.contentWindow.location.reload(); }
      const api = {id, tabEl, iframe, navigate, goBack, goForward, reload, setActive, get url(){return history[idx]||''}, close(){iframe.remove(); tabEl.remove();}}
      if(startURL) navigate(startURL); else showNewTabPage(iframe, titleEl);
      tabs.push(api);
      return api;
    }
    function showNewTabPage(iframe, titleEl){
      const ntpHtml = `
        <html><head><meta name="viewport" content="width=device-width,initial-scale=1"></head>
        <body style="font-family:system-ui,Arial;display:flex;align-items:center;justify-content:center;height:100%;margin:0;background:linear-gradient(#081022,#021016);color:#cfe7ff">
          <div style="text-align:center;max-width:900px;padding:24px">
            <h1 style="margin:0 0 8px 0;font-weight:600">New Tab</h1>
            <p style="color:rgba(255,255,255,0.65)">Search the web or paste a URL into the address bar.</p>
            <form id="s" onsubmit="event.preventDefault();location.href='https://www.google.com/search?q='+encodeURIComponent(document.getElementById('q').value);">
              <input id="q" placeholder="Search Google or paste URL" style="width:60vw;min-width:260px;padding:12px;border-radius:28px;border:0;outline:none;box-shadow:0 2px 12px rgba(0,0,0,0.6)">
            </form>
            <div style="margin-top:18px;color:rgba(255,255,255,0.6)">Quick links: <a href="https://news.ycombinator.com" target="_top">Hacker News</a> ¬∑ <a href="https://github.com" target="_top">GitHub</a></div>
          </div>
        </body></html>`;
      iframe.src = 'data:text/html;charset=utf-8,' + encodeURIComponent(ntpHtml);
      titleEl.textContent = 'New Tab';
    }
    function createTab(url){
      const t = makeTab('New Tab', url);
      t.setActive();
      return t;
    }
    function closeTab(id){
      const idx = tabs.findIndex(t=>t.id===id);
      if(idx===-1) return;
      const closing = tabs[idx];
      closing.close();
      tabs.splice(idx,1);
      if(tabs.length){
        const next = tabs[Math.max(0, idx-1)];
        next.setActive();
      } else {
        createTab();
      }
    }
    function updateAddress(){
      const t = tabs.find(x=>x.id===activeId);
      if(!t){ urlInput.value = ''; return}
      urlInput.value = t.url || '';
      backBtn.disabled = !(t && t.iframe && t.iframe.src && t.iframe.src !== '' && typeof t.goBack === 'function' && t.iframe.dataset.tabId);
    }
    createTab();
    urlInput.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){
        const t = tabs.find(x=>x.id===activeId);
        if(!t) return;
        t.navigate(urlInput.value.trim());
      }
    });
    newTabBtn.addEventListener('click', ()=>createTab());
    backBtn.addEventListener('click', ()=>{ const t = tabs.find(x=>x.id===activeId); if(t) t.goBack(); updateAddress(); });
    forwardBtn.addEventListener('click', ()=>{ const t = tabs.find(x=>x.id===activeId); if(t) t.goForward(); updateAddress(); });
    reloadBtn.addEventListener('click', ()=>{ const t = tabs.find(x=>x.id===activeId); if(t) t.reload(); });
    homeBtn.addEventListener('click', ()=>{ const t = tabs.find(x=>x.id===activeId); if(t) { showNewTabPage(t.iframe, t.tabEl.querySelector('.title')); t.iframe.dataset.home = '1'; updateAddress(); }});
    window.addEventListener('keydown',(e)=>{
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='t'){ e.preventDefault(); createTab(); }
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='w'){ e.preventDefault(); const t = tabs.find(x=>x.id===activeId); if(t) closeTab(t.id); }
    });
    viewport.addEventListener('load', (ev)=>{}, true);
    const observer = new MutationObserver(()=>{
      document.querySelectorAll('iframe').forEach(iframe=>{
        if(!iframe._attached){
          iframe.addEventListener('load', ()=>{
            try{
              const t = tabs.find(x=>x.iframe===iframe);
              const doc = iframe.contentDocument || iframe.contentWindow.document;
              if(doc && doc.title) {
                t.tabEl.querySelector('.title').textContent = doc.title;
              }
              const loc = iframe.contentWindow.location.href;
              if(loc) {
                t.iframe.src = loc;
                updateAddress();
              }
            }catch(e){}
          });
          iframe._attached = true;
        }
      });
    });
    observer.observe(viewport,{childList:true,subtree:true});
    tabbar.addEventListener('dblclick', ()=>urlInput.focus());
    urlInput.addEventListener('focus', ()=>urlInput.select());
    window.BIB = {createTab, tabs};
  </script>
</body>
</html>